<!DOCTYPE html>
<html>
<head>
    <title>ckinan.com: Netlify Functions</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/styles.css">
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </nav>
    </header>
    <h1>Netlify Functions</h1>
    <section>
        <p>
    Date: 2020-03-07
</p>
<p>Exploring Netlify Functions: Concepts and some examples to get started with serverless functions.</p>
<h2>Motivation</h2>
<p>Sometimes I want to build simple web applications for demos or just for fun. These ideas relates interactions with APIs (free ones in most of the cases). However, even when these APIs have free plans, they force you to create an API KEY, which you don't want to expose for security reasons.</p>
<p>I don't want to use secret keys in a single font end web application, because that approach would expose my keys. So, I have to handle those in a server side (backend apps). And here is where serverless functions caught my attention.</p>
<p>There are some options I was checking to create and use serverless functions, but as I am already working with Netlify for this website, I wanted to give it a try and use &quot;Netlify Functions&quot;.</p>
<h2>What is &quot;Netlify Functions&quot;?</h2>
<p>Serverless functions on AWS Lambda, handled by Netlify. Create, build, deploy and test these serverless functions on Netlify and locally with some great tools that Netlify provides.</p>
<p>Currently, supported languages are:</p>
<ul>
<li>JavaScript</li>
<li>Go</li>
</ul>
<h2>Concepts</h2>
<p>To get started with Netlify Functions, I've found some particulars to create, configure and serve your functions.</p>
<ul>
<li>netlify.toml (configuration file)</li>
<li>Structure of a function (obviously)</li>
<li>Commands to build and serve (the latter is optional if you want to deploy it locally)</li>
</ul>
<p>Lets check some few details about them.</p>
<h3>netlify.toml</h3>
<p>This file contains the configurations of your functions project. For this (very) small example, I am just specifying where the built functions are located (&quot;dist&quot; folder).</p>
<p>Ref: https://docs.netlify.com/configure-builds/file-based-configuration/</p>
<p>Example:</p>
<pre><code>[build]
  functions = &quot;dist&quot; # build output will be here
</code></pre>
<h3>Structure of a function</h3>
<p>From a &quot;hello world&quot; example found here: https://functions-playground.netlify.com/</p>
<pre><code class="language-js">exports.handler = function (event, context, callback) {
  callback(null, {
    statusCode: 200,
    body: &quot;Hello, World&quot;,
  })
}
</code></pre>
<p>Declare <code>exports.handler</code> function with the following parameters:</p>
<ul>
<li><code>event</code> : Requests data</li>
<li><code>context</code> : Context of the call. Example: <a href="https://docs.netlify.com/functions/functions-and-identity/#access-identity-info-via-clientcontext">Functions with Netlify Identity</a></li>
<li><code>callback</code> : Creates reponses</li>
</ul>
<h2>Commands to build and serve</h2>
<ul>
<li><code>netlify-lambda build</code> : Builds your function source code and place it into your built folder specified in the <code>netlify.toml</code> configuration file in <code>functions</code>. <a href="https://github.com/netlify/netlify-lambda#netlify-lambda-build">Ref</a></li>
<li><code>netlify-lambda serve</code> : Runs your function locally. <a href="https://github.com/netlify/netlify-lambda#netlify-lambda-serve-legacy-command">Ref</a></li>
</ul>
<h2>Getting started (example step by step)</h2>
<ol>
<li>Initialize your project</li>
</ol>
<pre><code class="language-bash">npm init
</code></pre>
<ol start="2">
<li>Install <code>netlify-lambda</code> command locally</li>
</ol>
<pre><code class="language-bash">yarn add netlify-lambda
</code></pre>
<ol start="3">
<li>Create the <code>netlify.toml</code> file</li>
</ol>
<pre><code class="language-toml">[build]
  functions = &quot;dist&quot; # build output will be here
</code></pre>
<ol start="4">
<li>Add <code>build</code> and <code>serve</code> scripts to <code>package.json</code>. Note our source code folder is in <code>./src</code> path.</li>
</ol>
<pre><code class="language-js">  :
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;netlify-lambda build src&quot;,
    &quot;install&quot;: &quot;netlify-lambda install src&quot;,
    &quot;serve&quot;: &quot;netlify-lambda serve src&quot;
  },
  :
</code></pre>
<ol start="5">
<li>Create your first function and name the file as <code>hello-world.js</code>.</li>
</ol>
<pre><code class="language-js">exports.handler = function (event, context, callback) {
  callback(null, {
    statusCode: 200,
    body: &quot;Hello, World&quot;,
  })
}
</code></pre>
<p>Your source tree should look like:</p>
<p><img src="./images/0.png" alt="" /></p>
<ol start="7">
<li>Deploy</li>
</ol>
<p>Two options: Locally and on Netlify</p>
<p>7.1. Option 1: Locally</p>
<pre><code class="language-js">npm run serve
</code></pre>
<p>You will see your port where your local function is exposed:</p>
<pre><code>[0] ./hello-world.js 129 bytes {0} [built]
Lambda server is listening on 9000
</code></pre>
<p>Open in a browser: http://localhost:9000/.netlify/functions/hello-world</p>
<blockquote>
<p>Note: The path of the URL is: http://{host}:{port}/.netlify/functions/{your-function-name}) . UPDATE: I tried to change the <code>.netlify/functions</code> path thing, but it was not possible. But, it is possible to redirect requests asking for your functions to whatever alias you want to have like <code>/api</code> for instance. See: <a href="https://docs.netlify.com/routing/redirects/#syntax-for-the-netlify-configuration-file">Netlify Routing Redirects</a>.</p>
</blockquote>
<p>You will see the response of the function: &quot;Hello, World&quot;</p>
<p><img src="./images/1.png" alt="" /></p>
<p>7.2. Deploy on Netlify</p>
<p>Commit and push your project into Github/Gitlab/Bitbucket, and deploy your project in Netlify, where the &quot;Build Command&quot; should be in this case: <code>npm run install</code>. Once it got deployed, you can see the list of functions in Netlify under <code>Project &gt; Functions</code>.</p>
<p><img src="./images/2.png" alt="" /></p>
<p>Click on any of your functions, you will see the URL to invoke it. Example</p>
<p><img src="./images/3.png" alt="" /></p>
<blockquote>
<p>Note: There are really good examples provided by Netlify Team of what you can do within a single function. I actually used them for this article. Link: https://functions-playground.netlify.com/</p>
</blockquote>
<h2>Logging</h2>
<p>Quoting docs: https://docs.netlify.com/functions/logs/</p>
<blockquote>
<p>Netlify displays a running log for the last hour of activity, including:</p>
<ul>
<li>Start of each invocation</li>
<li>Any console.log() statements you include in your function code</li>
</ul>
</blockquote>
<h2>Environment variables</h2>
<p>Following another example from https://functions-playground.netlify.com/ to get environment variables, create <code>env.js</code> under <code>src</code> folder.</p>
<pre><code class="language-js">const GREETING = process.env.GREETING

exports.handler = async (event, context) =&gt; {
  return {
    statusCode: 200,
    body: GREETING,
  }
}
</code></pre>
<p>Here, <code>GREETING</code> is your environment variable. This is how you &quot;hide&quot; certain values you don't want to share publicly to your clients behind a serverless function like this. Even if your source code is public in Github, you won't need to have secret information in your code, but in environment variables like so.</p>
<p>In the above example, if you are running:</p>
<ul>
<li>Locally: Follow instructions in this link https://github.com/netlify/netlify-lambda/issues/118#issuecomment-506973346</li>
<li>On Netlify: Just create an environment variable under <code>Project &gt; Settings &gt; Build &amp; Deploy &gt; Environment</code> option.</li>
</ul>
<p><img src="./images/4.png" alt="" /></p>
<h2>Final thoughts</h2>
<p>Netlify Functions is definitely a great choice to get started with serverless functions and it will (for sure) help me to accomplish what I was looking for: to hide api secret keys to invoke third party's APIs (more than likely I'll reuse the &quot;fetch.js&quot; example).</p>
<p>I am pretty sure there a lot more features Netlify provides within Functions behind the scenes happening that I am not aware of right now. But, I am happy with what I've just explored and learned about it, most importantly, Netlify is clear in their documentations and has a great community out there with super easy tutorials for beginners (like myself).</p>
<p>Github repo: https://github.com/ckinan/ckn-netlify-functions</p>
<p>EDIT: Here is another example using Netlify Functions and this free API to get the weather: https://weatherstack.com/ . Repo: https://github.com/ckinan/ckn-netlify-weather</p>
<h2>References</h2>
<ul>
<li>Official docs: https://docs.netlify.com/functions/overview/</li>
<li><code>netlify-lambda</code>: https://github.com/netlify/netlify-lambda</li>
<li>Local environment variables https://github.com/netlify/netlify-lambda/issues/118#issuecomment-506973346</li>
<li>Great article to get started: https://kentcdodds.com/blog/super-simple-start-to-serverless</li>
<li>Another great article: https://flaviocopes.com/netlify-functions/</li>
</ul>

    </section>
</body>
</html>